
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="./">
      
      
        <link rel="next" href="../changelog/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>xarray - cdflib</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#xarray" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="cdflib" class="md-header__button md-logo" aria-label="cdflib" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            cdflib
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              xarray
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="lime"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/lasp/cdflib" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../cdfread/" class="md-tabs__link">
          
  
  
  Tools

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  xarray

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../changelog/" class="md-tabs__link">
        
  
  
    
  
  Changelog

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../development/" class="md-tabs__link">
        
  
  
    
  
  Development

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="cdflib" class="md-nav__button md-logo" aria-label="cdflib" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    cdflib
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/lasp/cdflib" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Tools
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tools
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cdfread/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Reading CDFs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cdfwrite/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Writing CDFs
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../cdfepoch/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Time Conversions
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclasses/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    dataclasses
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    xarray
  

    
  </span>
  
  

      </a>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    xarray
  

    
  </span>
  
  

      </a>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Changelog
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Development
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href=".." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../cdfread/" class="md-path__link">
          
  <span class="md-ellipsis">
    Tools
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/lasp/cdflib/edit/master/docs/xarray.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/lasp/cdflib/raw/master/docs/xarray.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="xarray">xarray<a class="headerlink" href="#xarray" title="Permanent link">¤</a></h1>
<p>There are two functions for working with XArray Datasets, one for converting
a CDF to a DataSet, and one for going the other way. To use these you need
the <code>xarray</code> package installed.</p>
<p>These will attempt to determine any
<a href="https://spdf.gsfc.nasa.gov/istp_guide/istp_guide.html">ISTP Compliance</a>, and incorporate that into the output.</p>


<div class="doc doc-object doc-function">


<h1 id="cdflib.xarray.cdf_to_xarray.cdf_to_xarray" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">cdf_to_xarray</span>


<a href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray" class="headerlink" title="Permanent link">¤</a></h1>
<div class="language-python doc-signature highlight"><pre><span></span><code><span class="nf">cdf_to_xarray</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(filename)">filename</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_datetime)">to_datetime</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_unixtime)">to_unixtime</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(fillval_to_nan)">fillval_to_nan</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="xarray.Dataset">Dataset</span></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>This function converts CDF files into XArray Dataset Objects.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.cdf_to_xarray.cdf_to_xarray(filename)" class="doc doc-heading doc-heading-parameter">                  <code>filename</code>
<a href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(filename)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code> str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the CDF file to read</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_datetime)" class="doc doc-heading doc-heading-parameter">                  <code>to_datetime</code>
<a href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_datetime)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to convert CDF_EPOCH/EPOCH_16/TT2000 to datetime64, or leave them as is</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_unixtime)" class="doc doc-heading doc-heading-parameter">                  <code>to_unixtime</code>
<a href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(to_unixtime)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code> bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to convert CDF_EPOCH/EPOCH_16/TT2000 to unixtime, or leave them as is</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.cdf_to_xarray.cdf_to_xarray(fillval_to_nan)" class="doc doc-heading doc-heading-parameter">                  <code>fillval_to_nan</code>
<a href="#cdflib.xarray.cdf_to_xarray.cdf_to_xarray(fillval_to_nan)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, any data values that match the FILLVAL attribute for a variable will be set to NaN</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dataset</code></td>            <td>
                  <code><span title="cdflib.xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An XArray Dataset object containing all of the data and attributes from the CDF file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-mms" open>
  <summary>Example MMS</summary>
  <div class="language-python highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Import necessary libraries</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">cdflib.xarray</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Download a CDF file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Load in and display the CDF file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mms_data</span> <span class="o">=</span> <span class="n">cdflib</span><span class="o">.</span><span class="n">xarray</span><span class="o">.</span><span class="n">cdf_to_xarray</span><span class="p">(</span><span class="s2">&quot;mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&quot;</span><span class="p">,</span> <span class="n">to_unixtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fillval_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Show off XArray functionality</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Slice the data using built in XArray functions</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mms_data2</span> <span class="o">=</span> <span class="n">mms_data</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">dim0</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Plot the sliced data using built in XArray functions</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mms_data2</span><span class="p">[</span><span class="s1">&#39;mms2_fgm_b_gse_srvy_l2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Zoom in on the slices data in time using built in XArray functions</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mms_data3</span> <span class="o">=</span> <span class="n">mms_data2</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">Epoch</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">716000</span><span class="p">,</span><span class="mi">717000</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Plot the zoomed in sliced data using built in XArray functionality</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">mms_data3</span><span class="p">[</span><span class="s1">&#39;mms2_fgm_b_gse_srvy_l2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div>
</details>

<details class="example-themis" open>
  <summary>Example THEMIS</summary>
  <div class="language-python highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Import necessary libraries</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">cdflib.xarray</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Download a CDF file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;thg_l2_mag_amd_20070323_v01.cdf&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/thg_l2_mag_amd_20070323_v01.cdf&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Load in and display the CDF file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">thg_data</span> <span class="o">=</span> <span class="n">cdflib</span><span class="o">.</span><span class="n">xarray</span><span class="o">.</span><span class="n">cdf_to_xarray</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">to_unixtime</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fillval_to_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</code></pre></div>
</details>

<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <div class="language-text highlight"><pre><span></span><code>1. For each variable in the CDF file
    1. Determine the name of the dimension that spans the data &quot;records&quot;
        - Check if the variable itself might be a dimension
        - The DEPEND_0 likely points to the approrpiate dimensions
        - If neither of the above, we create a new dimensions named &quot;recordX&quot;
    2. Determine the name of the other dimensions of the variable, if they exist
        - Check if the variable name itself might be a dimension
        - The DEPEND_X probably points to the appropriate dimensions for that variable, so we check those
        - If either of the above are time varying, the code appends &quot;_dim&quot; to the end of the name
        - If no dimensions are found through the above checks, create a dumension named &quot;dimX&quot;
    3. Gather all attributes that belong to the variable
    4. Add a few attributes that enable better plotting with built-in xarray functions (name, units, etc)
    5. Optionally, convert FILLVALs to NaNs in the data
    6. Optionally, convert CDF_EPOCH/EPOCH16/TT2000 variables to unixtime or datetime
    7. Create an XArray Variable object using the dimensions determined in steps 1 and 2, the attributes from steps 3 and 4, and then the variable data
2. Gather all the Variable objects created in the first step, and separate them into data variables or coordinate variables
3. Gather all global scope attributes in the CDF file
4. Create an XArray Dataset objects with the data variables, coordinate variables, and global attributes.
</code></pre></div>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>cdflib/xarray/cdf_to_xarray.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cdf_to_xarray</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">to_datetime</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">to_unixtime</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">fillval_to_nan</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function converts CDF files into XArray Dataset Objects.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename :  str</span>
<span class="sd">        The path to the CDF file to read</span>
<span class="sd">    to_datetime : bool, optional</span>
<span class="sd">        Whether or not to convert CDF_EPOCH/EPOCH_16/TT2000 to datetime64, or leave them as is</span>
<span class="sd">    to_unixtime :  bool, optional</span>
<span class="sd">        Whether or not to convert CDF_EPOCH/EPOCH_16/TT2000 to unixtime, or leave them as is</span>
<span class="sd">    fillval_to_nan : bool, optional</span>
<span class="sd">        If True, any data values that match the FILLVAL attribute for a variable will be set to NaN</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dataset : xarray.Dataset</span>
<span class="sd">        An XArray Dataset object containing all of the data and attributes from the CDF file</span>

<span class="sd">    Example MMS</span>
<span class="sd">    -----------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; # Import necessary libraries</span>
<span class="sd">    &gt;&gt;&gt; import cdflib.xarray</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; import urllib.request</span>

<span class="sd">    &gt;&gt;&gt; # Download a CDF file</span>
<span class="sd">    &gt;&gt;&gt; fname = &#39;mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&#39;</span>
<span class="sd">    &gt;&gt;&gt; url = (&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&quot;)</span>
<span class="sd">    &gt;&gt;&gt; if not os.path.exists(fname):</span>
<span class="sd">    &gt;&gt;&gt;     urllib.request.urlretrieve(url, fname)</span>

<span class="sd">    &gt;&gt;&gt; # Load in and display the CDF file</span>
<span class="sd">    &gt;&gt;&gt; mms_data = cdflib.xarray.cdf_to_xarray(&quot;mms2_fgm_srvy_l2_20160809_v4.47.0.cdf&quot;, to_unixtime=True, fillval_to_nan=True)</span>

<span class="sd">    &gt;&gt;&gt; # Show off XArray functionality</span>

<span class="sd">    &gt;&gt;&gt; # Slice the data using built in XArray functions</span>
<span class="sd">    &gt;&gt;&gt; mms_data2 = mms_data.isel(dim0=0)</span>
<span class="sd">    &gt;&gt;&gt; # Plot the sliced data using built in XArray functions</span>
<span class="sd">    &gt;&gt;&gt; mms_data2[&#39;mms2_fgm_b_gse_srvy_l2&#39;].plot()</span>
<span class="sd">    &gt;&gt;&gt; # Zoom in on the slices data in time using built in XArray functions</span>
<span class="sd">    &gt;&gt;&gt; mms_data3 = mms_data2.isel(Epoch=slice(716000,717000))</span>
<span class="sd">    &gt;&gt;&gt; # Plot the zoomed in sliced data using built in XArray functionality</span>
<span class="sd">    &gt;&gt;&gt; mms_data3[&#39;mms2_fgm_b_gse_srvy_l2&#39;].plot()</span>
<span class="sd">    ```</span>

<span class="sd">    Example THEMIS</span>
<span class="sd">    --------------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; # Import necessary libraries</span>
<span class="sd">    &gt;&gt;&gt; import cdflib.xarray</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; import urllib.request</span>

<span class="sd">    &gt;&gt;&gt; # Download a CDF file</span>
<span class="sd">    &gt;&gt;&gt; fname = &#39;thg_l2_mag_amd_20070323_v01.cdf&#39;</span>
<span class="sd">    &gt;&gt;&gt; url = (&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/thg_l2_mag_amd_20070323_v01.cdf&quot;)</span>
<span class="sd">    &gt;&gt;&gt; if not os.path.exists(fname):</span>
<span class="sd">    &gt;&gt;&gt;     urllib.request.urlretrieve(url, fname)</span>

<span class="sd">    &gt;&gt;&gt; # Load in and display the CDF file</span>
<span class="sd">    &gt;&gt;&gt; thg_data = cdflib.xarray.cdf_to_xarray(fname, to_unixtime=True, fillval_to_nan=True)</span>
<span class="sd">    ```</span>

<span class="sd">    Processing Steps</span>
<span class="sd">    ----------------</span>
<span class="sd">        1. For each variable in the CDF file</span>
<span class="sd">            1. Determine the name of the dimension that spans the data &quot;records&quot;</span>
<span class="sd">                - Check if the variable itself might be a dimension</span>
<span class="sd">                - The DEPEND_0 likely points to the approrpiate dimensions</span>
<span class="sd">                - If neither of the above, we create a new dimensions named &quot;recordX&quot;</span>
<span class="sd">            2. Determine the name of the other dimensions of the variable, if they exist</span>
<span class="sd">                - Check if the variable name itself might be a dimension</span>
<span class="sd">                - The DEPEND_X probably points to the appropriate dimensions for that variable, so we check those</span>
<span class="sd">                - If either of the above are time varying, the code appends &quot;_dim&quot; to the end of the name</span>
<span class="sd">                - If no dimensions are found through the above checks, create a dumension named &quot;dimX&quot;</span>
<span class="sd">            3. Gather all attributes that belong to the variable</span>
<span class="sd">            4. Add a few attributes that enable better plotting with built-in xarray functions (name, units, etc)</span>
<span class="sd">            5. Optionally, convert FILLVALs to NaNs in the data</span>
<span class="sd">            6. Optionally, convert CDF_EPOCH/EPOCH16/TT2000 variables to unixtime or datetime</span>
<span class="sd">            7. Create an XArray Variable object using the dimensions determined in steps 1 and 2, the attributes from steps 3 and 4, and then the variable data</span>
<span class="sd">        2. Gather all the Variable objects created in the first step, and separate them into data variables or coordinate variables</span>
<span class="sd">        3. Gather all global scope attributes in the CDF file</span>
<span class="sd">        4. Create an XArray Dataset objects with the data variables, coordinate variables, and global attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">to_datetime</span> <span class="ow">and</span> <span class="n">to_unixtime</span><span class="p">:</span>
        <span class="n">to_datetime</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Convert the CDF file into a series of dicts, so we don&#39;t need to keep reading the file</span>
    <span class="n">global_attributes</span><span class="p">,</span> <span class="n">all_variable_attributes</span><span class="p">,</span> <span class="n">all_variable_data</span><span class="p">,</span> <span class="n">all_variable_properties</span> <span class="o">=</span> <span class="n">_convert_cdf_to_dicts</span><span class="p">(</span>
        <span class="n">filename</span><span class="p">,</span> <span class="n">to_datetime</span><span class="o">=</span><span class="n">to_datetime</span><span class="p">,</span> <span class="n">to_unixtime</span><span class="o">=</span><span class="n">to_unixtime</span>
    <span class="p">)</span>

    <span class="n">created_vars</span><span class="p">,</span> <span class="n">depend_dimensions</span> <span class="o">=</span> <span class="n">_generate_xarray_data_variables</span><span class="p">(</span>
        <span class="n">all_variable_data</span><span class="p">,</span> <span class="n">all_variable_attributes</span><span class="p">,</span> <span class="n">all_variable_properties</span><span class="p">,</span> <span class="n">fillval_to_nan</span>
    <span class="p">)</span>

    <span class="n">label_variables</span> <span class="o">=</span> <span class="n">_discover_label_variables</span><span class="p">(</span><span class="n">all_variable_attributes</span><span class="p">,</span> <span class="n">all_variable_properties</span><span class="p">,</span> <span class="n">all_variable_data</span><span class="p">)</span>
    <span class="n">uncertainty_variables</span> <span class="o">=</span> <span class="n">_discover_uncertainty_variables</span><span class="p">(</span><span class="n">all_variable_attributes</span><span class="p">)</span>

    <span class="c1"># Determine which dimensions are coordinates vs actual data</span>
    <span class="c1"># Variables are considered coordinates if one of the other dimensions depends on them.</span>
    <span class="c1"># Otherwise, they are considered data coordinates.</span>
    <span class="n">created_coord_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">created_data_vars</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">created_vars</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">label_variables</span><span class="p">:</span>
            <span class="c1"># If these are label variables, we&#39;ll deal with these later when the DEPEND variables come up</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">var_name</span> <span class="ow">in</span> <span class="n">depend_dimensions</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">var_name</span> <span class="o">+</span> <span class="s2">&quot;_dim&quot;</span> <span class="ow">in</span> <span class="n">depend_dimensions</span><span class="p">):</span>
            <span class="c1"># If these are DEPEND variables, add them to the DataSet coordinates</span>
            <span class="n">created_coord_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
            <span class="c1"># Check if these coordinate variable have associated labels</span>
            <span class="k">for</span> <span class="n">lab</span> <span class="ow">in</span> <span class="n">label_variables</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">label_variables</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span> <span class="o">==</span> <span class="n">var_name</span><span class="p">:</span>  <span class="c1"># Found one! Label &quot;lab&quot; covers the dimension &quot;var_name&quot;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">):</span>
                        <span class="k">if</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Warning, label variable </span><span class="si">{</span><span class="n">lab</span><span class="si">}</span><span class="s2"> does not match the expected dimension sizes of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># type: ignore</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                                <span class="sa">f</span><span class="s2">&quot;Warning, label variable </span><span class="si">{</span><span class="n">lab</span><span class="si">}</span><span class="s2"> does not match the expected dimension sizes of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span>
                            <span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="p">(</span><span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],)</span>
                    <span class="c1"># Add the labels to the coordinates as well</span>
                    <span class="n">created_coord_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">lab</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">var_name</span> <span class="ow">in</span> <span class="n">uncertainty_variables</span><span class="p">:</span>
            <span class="c1"># If there is an uncertainty variable, link it to the uncertainty along a dimension</span>
            <span class="k">if</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">uncertainty_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]]</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
                <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">uncertainty_variables</span><span class="p">[</span><span class="n">var_name</span><span class="p">]]</span><span class="o">.</span><span class="n">dims</span>
            <span class="n">created_data_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">created_data_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">created_vars</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>

    <span class="c1"># Check that the datasets are valid</span>
    <span class="n">_verify_dimension_sizes</span><span class="p">(</span><span class="n">created_data_vars</span><span class="p">,</span> <span class="n">created_coord_vars</span><span class="p">)</span>

    <span class="c1"># Create the XArray DataSet Object!</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="o">=</span><span class="n">created_data_vars</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="n">created_coord_vars</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">global_attributes</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h1 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <span class="doc doc-object-name doc-function-name">xarray_to_cdf</span>


<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf" class="headerlink" title="Permanent link">¤</a></h1>
<div class="language-python doc-signature highlight"><pre><span></span><code><span class="nf">xarray_to_cdf</span><span class="p">(</span><span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(xarray_dataset)">xarray_dataset</a></span><span class="p">:</span> <span class="n"><span title="xarray.Dataset">Dataset</span></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(file_name)">file_name</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(unix_time_to_cdf_time)">unix_time_to_cdf_time</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(istp)">istp</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(terminate_on_warning)">terminate_on_warning</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(auto_fix_depends)">auto_fix_depends</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(record_dimensions)">record_dimensions</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" title="&lt;code&gt;typing.List&lt;/code&gt;" href="https://docs.python.org/3/library/typing.html#typing.List">List</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;record0&#39;</span><span class="p">],</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(compression)">compression</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(nan_to_fillval)">nan_to_fillval</a></span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>This function converts XArray Dataset objects into CDF files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(xarray_dataset)" class="doc doc-heading doc-heading-parameter">                  <code>xarray_dataset</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(xarray_dataset)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><span title="cdflib.xarray.Dataset">Dataset</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The XArray Dataset object that you'd like to convert into a CDF file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(file_name)" class="doc doc-heading doc-heading-parameter">                  <code>file_name</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(file_name)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/stdtypes.html#str">str</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the place the newly created CDF file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(unix_time_to_cdf_time)" class="doc doc-heading doc-heading-parameter">                  <code>unix_time_to_cdf_time</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(unix_time_to_cdf_time)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to assume variables that will become a CDF_EPOCH/EPOCH16/TT2000 are a unix timestamp</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(istp)" class="doc doc-heading doc-heading-parameter">                  <code>istp</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(istp)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to do checks on the Dataset object to attempt to enforce CDF compliance</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(terminate_on_warning)" class="doc doc-heading doc-heading-parameter">                  <code>terminate_on_warning</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(terminate_on_warning)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to throw an error when given warnings or to continue trying to make the file</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(auto_fix_depends)" class="doc doc-heading doc-heading-parameter">                  <code>auto_fix_depends</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(auto_fix_depends)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to automatically add dependencies</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(record_dimensions)" class="doc doc-heading doc-heading-parameter">                  <code>record_dimensions</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(record_dimensions)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code>list of str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the code cannot determine which dimensions should be made into CDF records, you may provide a list of them here</p>
              </div>
            </td>
            <td>
                  <code>[&#39;record0&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(compression)" class="doc doc-heading doc-heading-parameter">                  <code>compression</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(compression)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The level of compression to gzip the data in the variables.  Default is no compression, standard is 6.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
<h2 id="cdflib.xarray.xarray_to_cdf.xarray_to_cdf(nan_to_fillval)" class="doc doc-heading doc-heading-parameter">                  <code>nan_to_fillval</code>
<a href="#cdflib.xarray.xarray_to_cdf.xarray_to_cdf(nan_to_fillval)" class="headerlink" title="Permanent link">¤</a></h2>            </td>
            <td>
                  <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#bool">bool</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Convert all np.nan and np.datetime64('NaT') to the standard CDF FILLVALs.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Function generates a CDF file</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example-cdf-file-from-scratch" open>
  <summary>Example CDF file from scratch</summary>
  <div class="language-python highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Import the needed libraries</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span><span class="w"> </span><span class="nn">cdflib.xarray</span><span class="w"> </span><span class="kn">import</span> <span class="n">xarray_to_cdf</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Create some fake data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">var_data</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">var_dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">var_dims</span><span class="p">,</span> <span class="n">var_data</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Create fake epoch data</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">epoch_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">epoch_dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;epoch&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">epoch</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">epoch_dims</span><span class="p">,</span> <span class="n">epoch_data</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Combine the two into an xarray Dataset and export as CDF (this will print out many ISTP warnings)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">})</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">xarray_to_cdf</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s1">&#39;hello.cdf&#39;</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Add some global attributes</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">global_attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Project&#39;</span><span class="p">:</span> <span class="s1">&#39;Hail Mary&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Source_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Thin Air&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Discipline&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Data_type&#39;</span><span class="p">:</span> <span class="s1">&#39;counts&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Descriptor&#39;</span><span class="p">:</span> <span class="s1">&#39;Midichlorians in unicorn blood&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Data_version&#39;</span><span class="p">:</span> <span class="s1">&#39;3.14&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Logical_file_id&#39;</span><span class="p">:</span> <span class="s1">&#39;SEVENTEEN&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;PI_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Darth Vader&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;PI_affiliation&#39;</span><span class="p">:</span> <span class="s1">&#39;Dark Side&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;TEXT&#39;</span><span class="p">:</span> <span class="s1">&#39;AHHHHH&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Instrument_type&#39;</span><span class="p">:</span> <span class="s1">&#39;Banjo&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Mission_group&#39;</span><span class="p">:</span> <span class="s1">&#39;Impossible&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Logical_source&#39;</span><span class="p">:</span> <span class="s1">&#39;:)&#39;</span><span class="p">,</span>
<span class="o">&gt;&gt;&gt;</span>                      <span class="s1">&#39;Logical_source_description&#39;</span><span class="p">:</span> <span class="s1">&#39;:(&#39;</span><span class="p">}</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Lets add a new coordinate variable for the &quot;direction&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dir_data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">dir_dims</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;direction&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">direction</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Variable</span><span class="p">(</span><span class="n">dir_dims</span><span class="p">,</span> <span class="n">dir_data</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Recreate the Dataset with this new objects, and recreate the CDF</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">data_vars</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;epoch&#39;</span><span class="p">:</span> <span class="n">epoch</span><span class="p">,</span> <span class="s1">&#39;direction&#39;</span><span class="p">:</span><span class="n">direction</span><span class="p">},</span> <span class="n">attrs</span><span class="o">=</span><span class="n">global_attributes</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s1">&#39;hello.cdf&#39;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">xarray_to_cdf</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s1">&#39;hello.cdf&#39;</span><span class="p">)</span>
</code></pre></div>
</details>

<details class="example-netcdf--&gt;-cdf-conversion" open>
  <summary>Example netCDF -&gt; CDF conversion</summary>
  <div class="language-python highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="c1"># Download a netCDF file (if needed)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">url</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Load in the dataset, and set VAR_TYPES attributes (the most important attribute as far as this code is concerned)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">goes_r_mag</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">load_dataset</span><span class="p">(</span><span class="s2">&quot;dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&quot;</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">goes_r_mag</span><span class="p">:</span>
<span class="o">&gt;&gt;&gt;</span>     <span class="n">goes_r_mag</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;VAR_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">goes_r_mag</span><span class="p">[</span><span class="s1">&#39;coordinate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;VAR_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;support_data&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">goes_r_mag</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;VAR_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;support_data&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">goes_r_mag</span><span class="p">[</span><span class="s1">&#39;time_orbit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;VAR_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;support_data&#39;</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Create the CDF file</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">xarray_to_cdf</span><span class="p">(</span><span class="n">goes_r_mag</span><span class="p">,</span> <span class="s1">&#39;hello.cdf&#39;</span><span class="p">)</span>
</code></pre></div>
</details>

<details class="processing-steps" open>
  <summary>Processing Steps</summary>
  <div class="language-text highlight"><pre><span></span><code>1. Determines the list of dimensions that represent time-varying dimensions.  These ultimately become the &quot;records&quot; of the CDF file
    - If it is named &quot;epoch&quot; or &quot;epoch_N&quot;, it is considered time-varying
    - If a variable points to another variable with a DEPEND_0 attribute, it is considered time-varying
    - If a variable has an attribute of VAR_TYPE equal to &quot;data&quot;, it is time-varying
    - If a variable has an attribute of VAR_TYPE equal to &quot;support_data&quot; and it is 2 dimensional, it is time-varying
2. Determine a list of &quot;dimension&quot; variables within the Dataset object
    - These are all coordinates in the dataset that are not time-varying
    - Additionally, variables that a DEPEND_N attribute points to are also considered dimensions
3. Optionally, if ISTP=true, automatically add in DEPEND_0/1/2/etc attributes as necessary
4. Optionally, if ISTP=true, check all variable attributes and global attributes are present
5. Convert all data into either CDF_INT8, CDF_DOUBLE, CDF_UINT4, or CDF_CHAR
6. Optionally, convert variables with the name &quot;epoch&quot; or &quot;epoch_N&quot; to CDF_TT2000
7. Write all variables and global attributes to the CDF file!
</code></pre></div>
</details>

<details class="istp-warnings" open>
  <summary>ISTP Warnings</summary>
  <div class="language-text highlight"><pre><span></span><code>If ISTP=true, these are some of the common things it will check:

- Missing or invalid VAR_TYPE variable attributes
- DEPEND_N missing from variables
- DEPEND_N/LABL_PTR/UNIT_PTR/FORM_PTR are pointing to missing variables
- Missing required global attributes
- Conflicting global attributes
- Missing an &quot;epoch&quot; dimension
- DEPEND_N attribute pointing to a variable with uncompatible dimensions
</code></pre></div>
</details>

<details class="cdf-data-types" open>
  <summary>CDF Data Types</summary>
  <div class="language-text highlight"><pre><span></span><code>All variable data is automatically converted to one of the following CDF types, based on the type of data in the xarray Dataset:

=============  ===============
Numpy type     CDF Data Type
=============  ===============
np.datetime64  CDF_TIME_TT2000
np.int8        CDF_INT1
np.int16       CDF_INT2
np.int32       CDF_INT4
np.int64       CDF_INT8
np.float16     CDF_FLOAT
np.float32     CDF_FLOAT
np.float64     CDF_DOUBLE
np.uint8       CDF_UINT1
np.uint16      CDF_UINT2
np.uint32      CDF_UINT4
np.complex_    CDF_EPOCH16
np.str_        CDF_CHAR
np.bytes_      CDF_CHAR
object         CDF_CHAR
datetime       CDF_TIME_TT2000
=============  ===============

If you want to attempt to cast your data to a different type, you need to add an attribute to your variable called &quot;CDF_DATA_TYPE&quot;.
xarray_to_cdf will read this attribute and override the default conversions.  Valid choices are

- Integers: CDF_INT1, CDF_INT2, CDF_INT4, CDF_INT8
- Unsigned Integers: CDF_UINT1, CDF_UINT2, CDF_UINT4
- Floating Point: CDF_REAL4, CDF_FLOAT, CDF_DOUBLE, CDF_REAL8
- Time: CDF_EPOCH, CDF_EPOCH16, CDF_TIME_TT2000
</code></pre></div>
</details>
          

            <details class="mkdocstrings-source">
              <summary>Source code in <code>cdflib/xarray/xarray_to_cdf.py</code></summary>
              <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">xarray_to_cdf</span><span class="p">(</span>
    <span class="n">xarray_dataset</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">unix_time_to_cdf_time</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">istp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">terminate_on_warning</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">auto_fix_depends</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">record_dimensions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;record0&quot;</span><span class="p">],</span>
    <span class="n">compression</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">nan_to_fillval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function converts XArray Dataset objects into CDF files.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xarray_dataset : xarray.Dataset</span>
<span class="sd">        The XArray Dataset object that you&#39;d like to convert into a CDF file</span>
<span class="sd">    file_name : str</span>
<span class="sd">        The path to the place the newly created CDF file</span>
<span class="sd">    unix_time_to_cdf_time : bool, optional</span>
<span class="sd">        Whether or not to assume variables that will become a CDF_EPOCH/EPOCH16/TT2000 are a unix timestamp</span>
<span class="sd">    istp : bool, optional</span>
<span class="sd">        Whether or not to do checks on the Dataset object to attempt to enforce CDF compliance</span>
<span class="sd">    terminate_on_warning : bool, optional</span>
<span class="sd">        Whether or not to throw an error when given warnings or to continue trying to make the file</span>
<span class="sd">    auto_fix_depends : bool, optional</span>
<span class="sd">        Whether or not to automatically add dependencies</span>
<span class="sd">    record_dimensions : list of str, optional</span>
<span class="sd">        If the code cannot determine which dimensions should be made into CDF records, you may provide a list of them here</span>
<span class="sd">    compression : int, optional</span>
<span class="sd">        The level of compression to gzip the data in the variables.  Default is no compression, standard is 6.</span>
<span class="sd">    nan_to_fillval : bool, optional</span>
<span class="sd">        Convert all np.nan and np.datetime64(&#39;NaT&#39;) to the standard CDF FILLVALs.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        Function generates a CDF file</span>

<span class="sd">    Example CDF file from scratch</span>
<span class="sd">    ------------------------------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; # Import the needed libraries</span>
<span class="sd">    &gt;&gt;&gt; from cdflib.xarray import xarray_to_cdf</span>
<span class="sd">    &gt;&gt;&gt; import xarray as xr</span>
<span class="sd">    &gt;&gt;&gt; import os</span>
<span class="sd">    &gt;&gt;&gt; import urllib.request</span>

<span class="sd">    &gt;&gt;&gt; # Create some fake data</span>
<span class="sd">    &gt;&gt;&gt; var_data = [[1, 2, 3], [1, 2, 3], [1, 2, 3]]</span>
<span class="sd">    &gt;&gt;&gt; var_dims = [&#39;epoch&#39;, &#39;direction&#39;]</span>
<span class="sd">    &gt;&gt;&gt; data = xr.Variable(var_dims, var_data)</span>

<span class="sd">    &gt;&gt;&gt; # Create fake epoch data</span>
<span class="sd">    &gt;&gt;&gt; epoch_data = [1, 2, 3]</span>
<span class="sd">    &gt;&gt;&gt; epoch_dims = [&#39;epoch&#39;]</span>
<span class="sd">    &gt;&gt;&gt; epoch = xr.Variable(epoch_dims, epoch_data)</span>

<span class="sd">    &gt;&gt;&gt; # Combine the two into an xarray Dataset and export as CDF (this will print out many ISTP warnings)</span>
<span class="sd">    &gt;&gt;&gt; ds = xr.Dataset(data_vars={&#39;data&#39;: data, &#39;epoch&#39;: epoch})</span>
<span class="sd">    &gt;&gt;&gt; xarray_to_cdf(ds, &#39;hello.cdf&#39;)</span>

<span class="sd">    &gt;&gt;&gt; # Add some global attributes</span>
<span class="sd">    &gt;&gt;&gt; global_attributes = {&#39;Project&#39;: &#39;Hail Mary&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Source_name&#39;: &#39;Thin Air&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Discipline&#39;: &#39;None&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Data_type&#39;: &#39;counts&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Descriptor&#39;: &#39;Midichlorians in unicorn blood&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Data_version&#39;: &#39;3.14&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Logical_file_id&#39;: &#39;SEVENTEEN&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;PI_name&#39;: &#39;Darth Vader&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;PI_affiliation&#39;: &#39;Dark Side&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;TEXT&#39;: &#39;AHHHHH&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Instrument_type&#39;: &#39;Banjo&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Mission_group&#39;: &#39;Impossible&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Logical_source&#39;: &#39;:)&#39;,</span>
<span class="sd">    &gt;&gt;&gt;                      &#39;Logical_source_description&#39;: &#39;:(&#39;}</span>

<span class="sd">    &gt;&gt;&gt; # Lets add a new coordinate variable for the &quot;direction&quot;</span>
<span class="sd">    &gt;&gt;&gt; dir_data = [1, 2, 3]</span>
<span class="sd">    &gt;&gt;&gt; dir_dims = [&#39;direction&#39;]</span>
<span class="sd">    &gt;&gt;&gt; direction = xr.Variable(dir_dims, dir_data)</span>

<span class="sd">    &gt;&gt;&gt; # Recreate the Dataset with this new objects, and recreate the CDF</span>
<span class="sd">    &gt;&gt;&gt; ds = xr.Dataset(data_vars={&#39;data&#39;: data, &#39;epoch&#39;: epoch, &#39;direction&#39;:direction}, attrs=global_attributes)</span>
<span class="sd">    &gt;&gt;&gt; os.remove(&#39;hello.cdf&#39;)</span>
<span class="sd">    &gt;&gt;&gt; xarray_to_cdf(ds, &#39;hello.cdf&#39;)</span>
<span class="sd">    ```</span>

<span class="sd">    Example netCDF -&gt; CDF conversion</span>
<span class="sd">    --------------------------------</span>
<span class="sd">    ```python</span>
<span class="sd">    &gt;&gt;&gt; # Download a netCDF file (if needed)</span>
<span class="sd">    &gt;&gt;&gt; fname = &#39;dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&#39;</span>
<span class="sd">    &gt;&gt;&gt; url = (&quot;https://lasp.colorado.edu/maven/sdc/public/data/sdc/web/cdflib_testing/dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&quot;)</span>
<span class="sd">    &gt;&gt;&gt; if not os.path.exists(fname):</span>
<span class="sd">    &gt;&gt;&gt;     urllib.request.urlretrieve(url, fname)</span>

<span class="sd">    &gt;&gt;&gt; # Load in the dataset, and set VAR_TYPES attributes (the most important attribute as far as this code is concerned)</span>
<span class="sd">    &gt;&gt;&gt; goes_r_mag = xr.load_dataset(&quot;dn_magn-l2-hires_g17_d20211219_v1-0-1.nc&quot;)</span>
<span class="sd">    &gt;&gt;&gt; for var in goes_r_mag:</span>
<span class="sd">    &gt;&gt;&gt;     goes_r_mag[var].attrs[&#39;VAR_TYPE&#39;] = &#39;data&#39;</span>
<span class="sd">    &gt;&gt;&gt; goes_r_mag[&#39;coordinate&#39;].attrs[&#39;VAR_TYPE&#39;] = &#39;support_data&#39;</span>
<span class="sd">    &gt;&gt;&gt; goes_r_mag[&#39;time&#39;].attrs[&#39;VAR_TYPE&#39;] = &#39;support_data&#39;</span>
<span class="sd">    &gt;&gt;&gt; goes_r_mag[&#39;time_orbit&#39;].attrs[&#39;VAR_TYPE&#39;] = &#39;support_data&#39;</span>

<span class="sd">    &gt;&gt;&gt; # Create the CDF file</span>
<span class="sd">    &gt;&gt;&gt; xarray_to_cdf(goes_r_mag, &#39;hello.cdf&#39;)</span>
<span class="sd">    ```</span>

<span class="sd">    Processing Steps</span>
<span class="sd">    ----------------</span>
<span class="sd">        1. Determines the list of dimensions that represent time-varying dimensions.  These ultimately become the &quot;records&quot; of the CDF file</span>
<span class="sd">            - If it is named &quot;epoch&quot; or &quot;epoch_N&quot;, it is considered time-varying</span>
<span class="sd">            - If a variable points to another variable with a DEPEND_0 attribute, it is considered time-varying</span>
<span class="sd">            - If a variable has an attribute of VAR_TYPE equal to &quot;data&quot;, it is time-varying</span>
<span class="sd">            - If a variable has an attribute of VAR_TYPE equal to &quot;support_data&quot; and it is 2 dimensional, it is time-varying</span>
<span class="sd">        2. Determine a list of &quot;dimension&quot; variables within the Dataset object</span>
<span class="sd">            - These are all coordinates in the dataset that are not time-varying</span>
<span class="sd">            - Additionally, variables that a DEPEND_N attribute points to are also considered dimensions</span>
<span class="sd">        3. Optionally, if ISTP=true, automatically add in DEPEND_0/1/2/etc attributes as necessary</span>
<span class="sd">        4. Optionally, if ISTP=true, check all variable attributes and global attributes are present</span>
<span class="sd">        5. Convert all data into either CDF_INT8, CDF_DOUBLE, CDF_UINT4, or CDF_CHAR</span>
<span class="sd">        6. Optionally, convert variables with the name &quot;epoch&quot; or &quot;epoch_N&quot; to CDF_TT2000</span>
<span class="sd">        7. Write all variables and global attributes to the CDF file!</span>

<span class="sd">    ISTP Warnings</span>
<span class="sd">    -------------</span>
<span class="sd">        If ISTP=true, these are some of the common things it will check:</span>

<span class="sd">        - Missing or invalid VAR_TYPE variable attributes</span>
<span class="sd">        - DEPEND_N missing from variables</span>
<span class="sd">        - DEPEND_N/LABL_PTR/UNIT_PTR/FORM_PTR are pointing to missing variables</span>
<span class="sd">        - Missing required global attributes</span>
<span class="sd">        - Conflicting global attributes</span>
<span class="sd">        - Missing an &quot;epoch&quot; dimension</span>
<span class="sd">        - DEPEND_N attribute pointing to a variable with uncompatible dimensions</span>

<span class="sd">    CDF Data Types</span>
<span class="sd">    --------------</span>
<span class="sd">        All variable data is automatically converted to one of the following CDF types, based on the type of data in the xarray Dataset:</span>

<span class="sd">        =============  ===============</span>
<span class="sd">        Numpy type     CDF Data Type</span>
<span class="sd">        =============  ===============</span>
<span class="sd">        np.datetime64  CDF_TIME_TT2000</span>
<span class="sd">        np.int8        CDF_INT1</span>
<span class="sd">        np.int16       CDF_INT2</span>
<span class="sd">        np.int32       CDF_INT4</span>
<span class="sd">        np.int64       CDF_INT8</span>
<span class="sd">        np.float16     CDF_FLOAT</span>
<span class="sd">        np.float32     CDF_FLOAT</span>
<span class="sd">        np.float64     CDF_DOUBLE</span>
<span class="sd">        np.uint8       CDF_UINT1</span>
<span class="sd">        np.uint16      CDF_UINT2</span>
<span class="sd">        np.uint32      CDF_UINT4</span>
<span class="sd">        np.complex_    CDF_EPOCH16</span>
<span class="sd">        np.str_        CDF_CHAR</span>
<span class="sd">        np.bytes_      CDF_CHAR</span>
<span class="sd">        object         CDF_CHAR</span>
<span class="sd">        datetime       CDF_TIME_TT2000</span>
<span class="sd">        =============  ===============</span>

<span class="sd">        If you want to attempt to cast your data to a different type, you need to add an attribute to your variable called &quot;CDF_DATA_TYPE&quot;.</span>
<span class="sd">        xarray_to_cdf will read this attribute and override the default conversions.  Valid choices are</span>

<span class="sd">        - Integers: CDF_INT1, CDF_INT2, CDF_INT4, CDF_INT8</span>
<span class="sd">        - Unsigned Integers: CDF_UINT1, CDF_UINT2, CDF_UINT4</span>
<span class="sd">        - Floating Point: CDF_REAL4, CDF_FLOAT, CDF_DOUBLE, CDF_REAL8</span>
<span class="sd">        - Time: CDF_EPOCH, CDF_EPOCH16, CDF_TIME_TT2000</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
        <span class="n">_warn_or_except</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> already exists, cannot create CDF file.  Returning...&quot;</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Make a deep copy of the data before continuing</span>
    <span class="n">dataset</span> <span class="o">=</span> <span class="n">xarray_dataset</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">nan_to_fillval</span><span class="p">:</span>
        <span class="n">_convert_nans_to_fillval</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">istp</span><span class="p">:</span>
        <span class="c1"># This checks all the variable and attribute names to ensure they are ISTP compliant.</span>
        <span class="n">_validate_varatt_names</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="c1"># This creates a list of suspected or confirmed label variables</span>
        <span class="n">_label_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="c1"># This creates a list of suspected or confirmed dimension variables</span>
        <span class="n">dim_vars</span> <span class="o">=</span> <span class="n">_dimension_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="c1"># This creates a list of suspected or confirmed record variables</span>
        <span class="n">depend_0_vars</span><span class="p">,</span> <span class="n">time_varying_dimensions</span> <span class="o">=</span> <span class="n">_epoch_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dim_vars</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="n">depend_0_vars</span> <span class="o">=</span> <span class="n">record_dimensions</span> <span class="o">+</span> <span class="n">depend_0_vars</span>
        <span class="n">time_varying_dimensions</span> <span class="o">=</span> <span class="n">record_dimensions</span> <span class="o">+</span> <span class="n">time_varying_dimensions</span>

        <span class="c1"># After we do the first pass of checking for dimensions and record variables, lets do a second pass to make sure</span>
        <span class="c1"># we&#39;ve got everything</span>
        <span class="n">dim_vars</span> <span class="o">=</span> <span class="n">_recheck_dimensions_after_epoch_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">time_varying_dimensions</span><span class="p">,</span> <span class="n">dim_vars</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="c1"># This function will alter the attributes of the data variables if needed</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">_add_depend_variables_to_dataset</span><span class="p">(</span>
            <span class="n">dataset</span><span class="p">,</span> <span class="n">dim_vars</span><span class="p">,</span> <span class="n">depend_0_vars</span><span class="p">,</span> <span class="n">time_varying_dimensions</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">,</span> <span class="n">auto_fix_depends</span>
        <span class="p">)</span>

        <span class="n">_global_attribute_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>

        <span class="n">_variable_attribute_checker</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">depend_0_vars</span><span class="p">,</span> <span class="n">terminate_on_warning</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">depend_0_vars</span> <span class="o">=</span> <span class="n">record_dimensions</span>
        <span class="n">time_varying_dimensions</span> <span class="o">=</span> <span class="n">record_dimensions</span>

    <span class="c1"># Gather the global attributes, write them into the file</span>
    <span class="n">glob_att_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">ga</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ga</span><span class="p">],</span> <span class="s2">&quot;__iter__&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ga</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">glob_att_dict</span><span class="p">[</span><span class="n">ga</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ga</span><span class="p">]:</span>
                <span class="n">glob_att_dict</span><span class="p">[</span><span class="n">ga</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">entry</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">glob_att_dict</span><span class="p">[</span><span class="n">ga</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">ga</span><span class="p">]}</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">CDF</span><span class="p">(</span><span class="n">file_name</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">write_globalattrs</span><span class="p">(</span><span class="n">glob_att_dict</span><span class="p">)</span>

    <span class="c1"># Gather the variables, write them into the file</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span>
            <span class="n">var</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">var</span><span class="p">)</span>

            <span class="n">cdf_data_type</span><span class="p">,</span> <span class="n">cdf_num_elements</span> <span class="o">=</span> <span class="n">_dtype_to_cdf_type</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">cdf_data_type</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">cdf_num_elements</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">time_varying_dimensions</span> <span class="ow">or</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">depend_0_vars</span><span class="p">:</span>
                    <span class="n">dim_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
                    <span class="n">record_vary</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dim_sizes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
                    <span class="n">record_vary</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dim_sizes</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">record_vary</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="n">var_data</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

            <span class="n">cdf_epoch</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cdf_epoch16</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="s2">&quot;CDF_DATA_TYPE&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;CDF_DATA_TYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CDF_EPOCH&quot;</span><span class="p">:</span>
                    <span class="n">cdf_epoch</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">elif</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;CDF_DATA_TYPE&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CDF_EPOCH16&quot;</span><span class="p">:</span>
                    <span class="n">cdf_epoch16</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">_is_datetime_array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">or</span> <span class="n">_is_datetime64_array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">):</span>
                <span class="n">var_data</span> <span class="o">=</span> <span class="n">_datetime_to_cdf_time</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">cdf_epoch</span><span class="o">=</span><span class="n">cdf_epoch</span><span class="p">,</span> <span class="n">cdf_epoch16</span><span class="o">=</span><span class="n">cdf_epoch16</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">unix_time_to_cdf_time</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">_is_istp_epoch_variable</span><span class="p">(</span><span class="n">var</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">DATATYPES_TO_STRINGS</span><span class="p">[</span><span class="n">cdf_data_type</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CDF_EPOCH&quot;</span><span class="p">,</span> <span class="s2">&quot;CDF_EPOCH16&quot;</span><span class="p">,</span> <span class="s2">&quot;CDF_TIME_TT2000&quot;</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="n">var_data</span> <span class="o">=</span> <span class="n">_unixtime_to_cdf_time</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">cdf_epoch</span><span class="o">=</span><span class="n">cdf_epoch</span><span class="p">,</span> <span class="n">cdf_epoch16</span><span class="o">=</span><span class="n">cdf_epoch16</span><span class="p">)</span>

            <span class="c1"># Grab the attributes from xarray, and attempt to convert VALIDMIN and VALIDMAX to the same data type as the variable</span>
            <span class="n">var_att_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                <span class="n">var_att_dict</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">att</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">_is_datetime_array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">att</span><span class="p">])</span> <span class="ow">or</span> <span class="n">_is_datetime64_array</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">att</span><span class="p">]):</span>
                    <span class="n">att_data</span> <span class="o">=</span> <span class="n">_datetime_to_cdf_time</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">],</span> <span class="n">cdf_epoch</span><span class="o">=</span><span class="n">cdf_epoch</span><span class="p">,</span> <span class="n">cdf_epoch16</span><span class="o">=</span><span class="n">cdf_epoch16</span><span class="p">,</span> <span class="n">attribute_name</span><span class="o">=</span><span class="n">att</span><span class="p">)</span>
                    <span class="n">var_att_dict</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">att_data</span><span class="p">,</span> <span class="n">DATATYPES_TO_STRINGS</span><span class="p">[</span><span class="n">cdf_data_type</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="n">unix_time_to_cdf_time</span><span class="p">:</span>
                    <span class="k">if</span> <span class="s2">&quot;TIME_ATTRS&quot;</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">att</span> <span class="ow">in</span> <span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;TIME_ATTRS&quot;</span><span class="p">]:</span>
                            <span class="k">if</span> <span class="n">DATATYPES_TO_STRINGS</span><span class="p">[</span><span class="n">cdf_data_type</span><span class="p">]</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CDF_EPOCH&quot;</span><span class="p">,</span> <span class="s2">&quot;CDF_EPOCH16&quot;</span><span class="p">,</span> <span class="s2">&quot;CDF_TIME_TT2000&quot;</span><span class="p">):</span>
                                <span class="n">att_data</span> <span class="o">=</span> <span class="n">_unixtime_to_cdf_time</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">att</span><span class="p">],</span> <span class="n">cdf_epoch</span><span class="o">=</span><span class="n">cdf_epoch</span><span class="p">,</span> <span class="n">cdf_epoch16</span><span class="o">=</span><span class="n">cdf_epoch16</span><span class="p">)</span>
                                <span class="n">var_att_dict</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">att_data</span><span class="p">,</span> <span class="n">DATATYPES_TO_STRINGS</span><span class="p">[</span><span class="n">cdf_data_type</span><span class="p">]]</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;VALIDMIN&quot;</span> <span class="ow">or</span> <span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;VALIDMAX&quot;</span> <span class="ow">or</span> <span class="n">att</span> <span class="o">==</span> <span class="s2">&quot;FILLVAL&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">istp</span><span class="p">:</span>
                    <span class="n">var_att_dict</span><span class="p">[</span><span class="n">att</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="n">att</span><span class="p">],</span> <span class="n">DATATYPES_TO_STRINGS</span><span class="p">[</span><span class="n">cdf_data_type</span><span class="p">]]</span>

            <span class="n">var_spec</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Variable&quot;</span><span class="p">:</span> <span class="n">var</span><span class="p">,</span>
                <span class="s2">&quot;Data_Type&quot;</span><span class="p">:</span> <span class="n">cdf_data_type</span><span class="p">,</span>
                <span class="s2">&quot;Num_Elements&quot;</span><span class="p">:</span> <span class="n">cdf_num_elements</span><span class="p">,</span>
                <span class="s2">&quot;Rec_Vary&quot;</span><span class="p">:</span> <span class="n">record_vary</span><span class="p">,</span>
                <span class="s2">&quot;Dim_Sizes&quot;</span><span class="p">:</span> <span class="n">dim_sizes</span><span class="p">,</span>
                <span class="s2">&quot;Compress&quot;</span><span class="p">:</span> <span class="n">compression</span><span class="p">,</span>
            <span class="p">}</span>

            <span class="n">x</span><span class="o">.</span><span class="n">write_var</span><span class="p">(</span><span class="n">var_spec</span><span class="p">,</span> <span class="n">var_attrs</span><span class="o">=</span><span class="n">var_att_dict</span><span class="p">,</span> <span class="n">var_data</span><span class="o">=</span><span class="n">var_data</span><span class="p">)</span>

    <span class="n">x</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="./" class="md-footer__link md-footer__link--prev" aria-label="Previous: xarray">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                xarray
              </div>
            </div>
          </a>
        
        
          
          <a href="../changelog/" class="md-footer__link md-footer__link--next" aria-label="Next: Changelog">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Changelog
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.instant.preview", "navigation.path", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", "navigation.top", "search.highlight", "search.suggest", "toc.follow"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>